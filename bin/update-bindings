#!/usr/bin/env bash

set -xe

cd backend

while getopts ":h:upload:" o; do
    case "${o}" in
        upload)
            upload=true
            ;;
        *)
            usage
            ;;
    esac
done


./bin/rake openstax_openapi:generate_client[1,typescript-fetch]
./bin/rake openstax_openapi:generate_client[1,r]
./bin/rake openstax_openapi:generate_model_bindings[1]


if [ -z "${upload}" ]; then
  tar cvzf kinetic-r-api.tar.gz -C clients/0.1.0 -s /^r/kinetic/ r
  aws s3 cp kinetic-r-api.tar.gz s3://kinetic-workspaces-config/configs/
fi
